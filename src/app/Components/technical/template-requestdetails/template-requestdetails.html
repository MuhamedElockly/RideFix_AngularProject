<div class="request-actions d-flex justify-content-center gap-3 mb-4">
  <!-- Technician View -->
  <!-- <ng-container *ngIf="url === '/technician/requestdetailsalltech'; else carOwnerActions">
    <button class="btn btn-warning px-4 shadow-sm" (click)="confirmApprovalWithPasswordApply(item)">
      <i class="fas fa-paper-plane me-2"></i>تقديم الآن
    </button>
  </ng-container> -->
  <!-- Car Owner View -->
  <!-- <ng-template #carOwnerActions>
    <button class="btn btn-danger px-4 shadow-sm" (click)="rejectApprovalWithPassword(item)">
      <i class="fas fa-times-circle me-2"></i>رفض الطلب
    </button> -->
  <!--
    <button class="btn btn-success px-4 shadow-sm" (click)="confirmApprovalWithPassword(item)">
      <i class="fas fa-check-circle me-2"></i>موافقة على الطلب
    </button>
    -->
  <!-- </ng-template> -->
</div>

<div class="card shadow-lg w-100 mx-auto request-details-card" dir="rtl">
  <div
    class="card-header bg-primary text-white pb-3 d-flex align-items-center justify-content-between"
  >
    <h2 class="card-title mb-0">
      <i class="fas fa-info-circle me-2"></i> تفاصيل المشكلة
    </h2>
    <span class="badge bg-secondary">{{ item?.category }}</span>
  </div>
  <div class="card-body">
    <div class="row g-4 align-items-stretch">
      <div
        class="col-md-6 d-flex flex-column align-items-center justify-content-center"
      >
        <img
          *ngIf="item?.requestImageUrl"
          [src]="item?.requestImageUrl"
          alt="صورة المشكلة"
          class="img-fluid rounded border mb-2"
          style="max-height: 300px; object-fit: contain; background: #f8f9fa"
        />
        <p
          class="text-muted mt-2"
          style="font-size: 0.9em"
          *ngIf="item?.requestImageUrl"
        >
          صورة توضيحية للمشكلة
        </p>
        <div
          *ngIf="!item?.requestImageUrl"
          class="text-center text-muted small"
        >
          لا توجد صورة متاحة
        </div>
      </div>
      <div class="col-md-6 col-12">
        <div class="mb-3">
          <h3 class="fw-bold h5">الوصف:</h3>
          <p class="text-muted">{{ item?.description }}</p>
        </div>
        <hr />
        <ul class="list-group list-group-flush mb-2 pe-0">
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            <span class="fw-bold">الحالة:</span>
            @if (item?.requestState === 1) {
            <span class="badge bg-info">قيد التنفيذ</span>

            } @else {

            <span class="badge bg-warning text-dark">قيد الانتظار</span>}
          </li>
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            <span class="fw-bold">تاريخ الإبلاغ:</span>

            <span class="text-muted">{{
              item?.timeStamp | date : "yyyy/MM/dd"
            }}</span>
          </li>
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            <span class="fw-bold">المبلغ عنه بواسطة:</span>
            <span class="text-muted">{{ item?.carOwnerName }}</span>
          </li>
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            <span class="fw-bold">الموقع:</span>
            <span class="text-muted">
              <a
                [href]="
                  'https://www.google.com/maps/search/?api=1&query=' +
                  item?.latitude +
                  ',' +
                  item?.longitude
                "
                target="_blank"
                rel="noopener noreferrer"
              >
                عرض على الخريطة
              </a>
            </span>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div
    class="card-footer bg-light d-flex flex-column flex-sm-row justify-content-end gap-2"
  >
    <!-- Technician View -->
    <ng-container *ngIf="item?.requestState !== 1">
      <ng-container
        *ngIf="url === '/technician/requestdetailsalltech'; else carOwnerFooter"
      >
        <button
          class="btn btn-outline-warning px-4 shadow-sm"
          (click)="confirmApprovalWithPasswordApply(item)"
        >
          <i class="fas fa-paper-plane me-2"></i>تقديم الآن
        </button>
      </ng-container>
      <!-- Car Owner View -->
      <ng-template #carOwnerFooter>
        <button
          class="btn btn-outline-danger px-4 shadow-sm"
          (click)="rejectApprovalWithPassword(item)"
        >
          <i class="fas fa-times-circle me-2"></i>رفض المشكلة
        </button>
        <!--
      <button class="btn btn-outline-success px-4 shadow-sm" (click)="confirmApprovalWithPassword(item)">
        <i class="fas fa-check-circle me-2"></i>الموافقة على الإصلاح
      </button>
      -->
      </ng-template>
    </ng-container>
  </div>
</div>
